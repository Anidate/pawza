import{a3 as I,a4 as C,j as e,a0 as l,T as f,r as c,u as A,ad as g,a6 as F,a2 as b,a7 as D,V as k,c as H,ae as q,af as T}from"./index-ZhOSqxDc.js";import{s as _,a as L,b as Y}from"./chats-KxGfttvm.js";import{d as h}from"./dayjs.min-Bn8fUXci.js";import{g as $}from"./TextField-Bi_uBe7J.js";var x={},B=C;Object.defineProperty(x,"__esModule",{value:!0});var y=x.default=void 0,N=B(I()),P=e;y=x.default=(0,N.default)((0,P.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function z({content:r,timestamp:n,isCurrentUser:o}){const d=(()=>{const i=h(),a=h(n);return a.isSame(i,"day")?a.format("HH:mm"):a.isSame(i.subtract(1,"day"),"day")?`Yesterday ${a.format("HH:mm")}`:a.isAfter(i.subtract(11,"month"))?a.format("D MMMM HH:mm"):a.format("D MMMM YYYY HH:mm")})();return e.jsxs(l,{sx:{alignSelf:o?"flex-end":"flex-start",maxWidth:"60%",padding:"0.5rem",borderStartStartRadius:"1rem",borderStartEndRadius:"1rem",borderEndEndRadius:o?0:"1rem",borderEndStartRadius:o?"1rem":0,backgroundColor:o?"#DCF8C6":"#F0F0F0",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",wordBreak:"break-word"},children:[e.jsx(f,{variant:"body1",textAlign:"left",children:r}),e.jsx(f,{variant:"caption",sx:{display:"block",textAlign:o?"right":"left",color:"#888"},children:d})]})}function G({chatId:r}){const[n,o]=c.useState(""),[d,i]=c.useState([]),{user:a}=A(),u=c.useRef(null),{data:s,isLoading:j,error:v}=g({queryKey:["chats",r],queryFn:()=>L(r)}),{data:m=[],isLoading:S,error:M}=g({queryKey:["chats",r,"messages"],queryFn:()=>Y(r),refetchInterval:2e3});c.useEffect(()=>{m.length>d.length&&i(m)},[d.length,m]),c.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[d]);const{mutateAsync:w}=F({mutationFn:t=>_(r,t)}),E=async t=>{t.preventDefault(),n.trim()!==""&&(o(""),i(R=>[...R,{content:n,senderId:a.id,timestamp:new Date().toISOString()}]),await w(n))},p=v||M;return j||S?e.jsx(b,{}):p?e.jsxs("div",{children:["Error: ",p.message]}):e.jsxs(l,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#fff",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsx(l,{sx:{padding:"1rem",backgroundColor:"#f9f9f9",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)"},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(D,{sx:{bgcolor:"primary.main",width:40,height:40},children:s==null?void 0:s.matchedUser.firstName.charAt(0)}),e.jsxs(f,{variant:"h6",sx:{fontWeight:600},children:[s==null?void 0:s.matchedUser.firstName," ",s==null?void 0:s.matchedUser.lastName]})]})}),e.jsx(l,{sx:{flexGrow:1,padding:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem",backgroundColor:"#fff",overflowY:"auto"},ref:u,children:d.map(t=>e.jsx(z,{content:t.content,timestamp:new Date(t.timestamp),isCurrentUser:t.senderId===a.id},`${t.senderId}_${t.timestamp}`))}),e.jsx(l,{component:"form",onSubmit:E,display:"flex",gap:"1rem",sx:{padding:"1rem",backgroundColor:"#fff",boxShadow:"0 -1px 3px rgba(0, 0, 0, 0.1)",borderTop:"1px solid #E0E0E0"},children:e.jsx($,{autoComplete:"off",variant:"outlined",sx:{background:"white",flexGrow:1,borderRadius:"1rem"},InputProps:{style:{borderRadius:"1rem"},endAdornment:e.jsx(k,{type:"submit",children:e.jsx(y,{})})},type:"text",placeholder:"Type a message...",value:n,onChange:t=>o(t.target.value)})})]})}function K(){const r=T({from:"/chats/$chatId/",select:n=>n.chatId});return r?e.jsx(G,{chatId:r}):e.jsx("div",{children:"Error: chatId is missing"})}const O=q(K),U=H("/chats/$chatId/")({component:O,pendingComponent:b});export{U as Route};
