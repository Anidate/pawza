import{ac as A,ad as F,j as e,a5 as l,S as f,r as c,u as C,ak as h,aa as D,ab as y,ae as g,Z as H,c as k,al as q,am as T}from"./index-BnhxqNBK.js";import{s as _,a as L,b as P}from"./chats-BLPCCH7g.js";import{d as b}from"./dayjs.min-CgrGDNzE.js";import{T as Y}from"./TextField-BrY9GZ8O.js";var x={},$=F;Object.defineProperty(x,"__esModule",{value:!0});var j=x.default=void 0,B=$(A()),N=e;j=x.default=(0,B.default)((0,N.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function z({content:a,timestamp:n,isCurrentUser:o}){const i=(()=>{const d=b(),s=b(n);return s.isSame(d,"day")?s.format("HH:mm"):s.isSame(d.subtract(1,"day"),"day")?`Yesterday ${s.format("HH:mm")}`:s.isAfter(d.subtract(11,"month"))?s.format("D MMMM HH:mm"):s.format("D MMMM YYYY HH:mm")})();return e.jsxs(l,{sx:{alignSelf:o?"flex-end":"flex-start",maxWidth:"60%",padding:"0.5rem",borderStartStartRadius:"1rem",borderStartEndRadius:"1rem",borderEndEndRadius:o?0:"1rem",borderEndStartRadius:o?"1rem":0,backgroundColor:o?"#DCF8C6":"#FFF",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",wordBreak:"break-word"},children:[e.jsx(f,{variant:"body1",textAlign:"left",children:a}),e.jsx(f,{variant:"caption",sx:{display:"block",textAlign:o?"right":"left",color:"#888"},children:i})]})}function G({chatId:a}){const[n,o]=c.useState(""),[i,d]=c.useState([]),{user:s}=C(),m=c.useRef(null),{data:t,isLoading:S,error:v}=h({queryKey:["chats",a],queryFn:()=>L(a)}),{data:u=[],isLoading:w,error:M}=h({queryKey:["chats",a,"messages"],queryFn:()=>P(a),refetchInterval:2e3});c.useEffect(()=>{u.length>i.length&&d(u)},[i.length,u]),c.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[i]);const{mutateAsync:E}=D({mutationFn:r=>_(a,r)}),R=async r=>{r.preventDefault(),n.trim()!==""&&(o(""),d(I=>[...I,{content:n,senderId:s.id,timestamp:new Date().toISOString()}]),await E(n))},p=v||M;return S||w?e.jsx(y,{}):p?e.jsxs("div",{children:["Error: ",p.message]}):e.jsxs(l,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsx(l,{sx:{padding:"1rem",backgroundColor:"#fff",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)"},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[t!=null&&t.matchedUser.profilePic?e.jsx(g,{sx:{width:40,height:40},src:t.matchedUser.profilePic}):e.jsx(g,{sx:{bgcolor:"primary.main",width:40,height:40},children:t==null?void 0:t.matchedUser.firstName.charAt(0)}),e.jsxs(f,{variant:"h6",sx:{fontWeight:600},children:[t==null?void 0:t.matchedUser.firstName," ",t==null?void 0:t.matchedUser.lastName]})]})}),e.jsx(l,{sx:{flexGrow:1,padding:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem",overflowY:"auto"},ref:m,children:i.map(r=>e.jsx(z,{content:r.content,timestamp:new Date(r.timestamp),isCurrentUser:r.senderId===s.id},`${r.senderId}_${r.timestamp}`))}),e.jsx(l,{component:"form",onSubmit:R,display:"flex",gap:"1rem",sx:{padding:"1rem",backgroundColor:"#fff",boxShadow:"0 -1px 3px rgba(0, 0, 0, 0.1)",borderTop:"1px solid #E0E0E0"},children:e.jsx(Y,{autoComplete:"off",variant:"outlined",sx:{background:"white",flexGrow:1,borderRadius:"1rem"},InputProps:{style:{borderRadius:"1rem"},endAdornment:e.jsx(H,{type:"submit",children:e.jsx(j,{})})},type:"text",placeholder:"Type a message...",value:n,onChange:r=>o(r.target.value)})})]})}function K(){const a=T({from:"/chats/$chatId/",select:n=>n.chatId});return a?e.jsx(G,{chatId:a}):e.jsx("div",{children:"Error: chatId is missing"})}const O=q(K),J=k("/chats/$chatId/")({component:O,pendingComponent:y});export{J as Route};
