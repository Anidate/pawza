import{a7 as C,a8 as A,j as e,a4 as l,S as f,r as c,u as F,ah as h,aa as D,a6 as y,ab as g,Y as k,c as H,ai as q,aj as T}from"./index-C31y_Pqt.js";import{s as Y,a as _,b as L}from"./chats-Dg2olIt2.js";import{d as b}from"./dayjs.min-DAt1ASTW.js";import{T as P}from"./TextField-Dnatj0SJ.js";var x={},$=A;Object.defineProperty(x,"__esModule",{value:!0});var j=x.default=void 0,B=$(C()),N=e;j=x.default=(0,B.default)((0,N.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function z({content:a,timestamp:o,isCurrentUser:n}){const i=(()=>{const d=b(),s=b(o);return s.isSame(d,"day")?s.format("HH:mm"):s.isSame(d.subtract(1,"day"),"day")?`Yesterday ${s.format("HH:mm")}`:s.isAfter(d.subtract(11,"month"))?s.format("D MMMM HH:mm"):s.format("D MMMM YYYY HH:mm")})();return e.jsxs(l,{sx:{alignSelf:n?"flex-end":"flex-start",maxWidth:"60%",padding:"0.5rem",borderStartStartRadius:"1rem",borderStartEndRadius:"1rem",borderEndEndRadius:n?0:"1rem",borderEndStartRadius:n?"1rem":0,backgroundColor:n?"#DCF8C6":"#F0F0F0",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",wordBreak:"break-word"},children:[e.jsx(f,{variant:"body1",textAlign:"left",children:a}),e.jsx(f,{variant:"caption",sx:{display:"block",textAlign:n?"right":"left",color:"#888"},children:i})]})}function G({chatId:a}){const[o,n]=c.useState(""),[i,d]=c.useState([]),{user:s}=F(),u=c.useRef(null),{data:r,isLoading:S,error:v}=h({queryKey:["chats",a],queryFn:()=>_(a)}),{data:m=[],isLoading:w,error:M}=h({queryKey:["chats",a,"messages"],queryFn:()=>L(a),refetchInterval:2e3});c.useEffect(()=>{m.length>i.length&&d(m)},[i.length,m]),c.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[i]);const{mutateAsync:E}=D({mutationFn:t=>Y(a,t)}),R=async t=>{t.preventDefault(),o.trim()!==""&&(n(""),d(I=>[...I,{content:o,senderId:s.id,timestamp:new Date().toISOString()}]),await E(o))},p=v||M;return S||w?e.jsx(y,{}):p?e.jsxs("div",{children:["Error: ",p.message]}):e.jsxs(l,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",backgroundColor:"#fff",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsx(l,{sx:{padding:"1rem",backgroundColor:"#f9f9f9",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)"},children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[r!=null&&r.matchedUser.profilePic?e.jsx(g,{sx:{width:40,height:40},src:r.matchedUser.profilePic}):e.jsx(g,{sx:{bgcolor:"primary.main",width:40,height:40},children:r==null?void 0:r.matchedUser.firstName.charAt(0)}),e.jsxs(f,{variant:"h6",sx:{fontWeight:600},children:[r==null?void 0:r.matchedUser.firstName," ",r==null?void 0:r.matchedUser.lastName]})]})}),e.jsx(l,{sx:{flexGrow:1,padding:"1rem",display:"flex",flexDirection:"column",gap:"0.75rem",backgroundColor:"#fff",overflowY:"auto"},ref:u,children:i.map(t=>e.jsx(z,{content:t.content,timestamp:new Date(t.timestamp),isCurrentUser:t.senderId===s.id},`${t.senderId}_${t.timestamp}`))}),e.jsx(l,{component:"form",onSubmit:R,display:"flex",gap:"1rem",sx:{padding:"1rem",backgroundColor:"#fff",boxShadow:"0 -1px 3px rgba(0, 0, 0, 0.1)",borderTop:"1px solid #E0E0E0"},children:e.jsx(P,{autoComplete:"off",variant:"outlined",sx:{background:"white",flexGrow:1,borderRadius:"1rem"},InputProps:{style:{borderRadius:"1rem"},endAdornment:e.jsx(k,{type:"submit",children:e.jsx(j,{})})},type:"text",placeholder:"Type a message...",value:o,onChange:t=>n(t.target.value)})})]})}function K(){const a=T({from:"/chats/$chatId/",select:o=>o.chatId});return a?e.jsx(G,{chatId:a}):e.jsx("div",{children:"Error: chatId is missing"})}const O=q(K),V=H("/chats/$chatId/")({component:O,pendingComponent:y});export{V as Route};
