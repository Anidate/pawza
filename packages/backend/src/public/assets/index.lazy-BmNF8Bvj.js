import{w as j,x as v,j as e,B as n,T as i,r as w,u as S,z as x,d as E,F as I,A as R,I as A,c as C,C as F,D as M}from"./index-DrTOdhyd.js";import{s as k,a as D,b as q}from"./chats-B3YDPhnu.js";import{T as L}from"./TextField-9Aj2Hnac.js";var d={},T=v;Object.defineProperty(d,"__esModule",{value:!0});var c=d.default=void 0,B=T(j()),_=e;c=d.default=(0,B.default)((0,_.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");const z=({content:r,timestamp:o,isCurrentUser:s})=>e.jsxs(n,{sx:{alignSelf:s?"flex-end":"flex-start",maxWidth:"60%",padding:"0.5rem",borderStartStartRadius:"1rem",borderStartEndRadius:"1rem",borderEndEndRadius:s?0:"1rem",borderEndStartRadius:s?"1rem":0,backgroundColor:s?"#DCF8C6":"#FFF",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",wordBreak:"break-word",marginBottom:"1rem"},children:[e.jsx(i,{variant:"body1",textAlign:"left",children:r}),e.jsx(i,{variant:"caption",sx:{display:"block",textAlign:s?"right":"left",marginTop:"0.5rem",color:"#888"},children:o.toLocaleString()})]});function N({chatId:r}){const[o,s]=w.useState(""),{user:u}=S(),{data:a,isLoading:m,error:f}=x({queryKey:["chats",r],queryFn:()=>D(r)}),{data:p=[],isLoading:g,error:h}=x({queryKey:["chats",r,"messages"],queryFn:()=>q(r),refetchInterval:2e3}),b=E({mutationFn:({content:t})=>k(r,t)}),y=async t=>{t.preventDefault(),o.trim()!==""&&(await b.mutateAsync({content:o}),s(""))},l=f||h;return m||g?e.jsx(I,{}):l?e.jsxs("div",{children:["Error: ",l.message]}):e.jsx(n,{sx:{display:"flex",flexDirection:"column",height:"100%",boxSizing:"border-box",alignItems:"center"},children:e.jsxs(n,{sx:{width:"100%",maxWidth:"600px",display:"flex",flexDirection:"column",backgroundColor:"#fff",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsx(n,{sx:{padding:"1rem",backgroundColor:"#f9f9f9",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx(R,{sx:{bgcolor:"primary.main",width:40,height:40},children:a==null?void 0:a.matchedUser.firstName.charAt(0)}),e.jsxs(i,{variant:"h6",sx:{fontWeight:600},children:[a==null?void 0:a.matchedUser.firstName," ",a==null?void 0:a.matchedUser.lastName]})]})}),e.jsx(n,{sx:{flexGrow:1,padding:"1rem",display:"flex",flexDirection:"column",gap:"1rem",backgroundColor:"#fff",overflowY:"auto"},children:p.map(t=>e.jsx(z,{content:t.content,timestamp:new Date(t.timestamp),isCurrentUser:t.senderId===u.id},t.id))}),e.jsx(n,{component:"form",onSubmit:y,display:"flex",gap:"1rem",sx:{padding:"1rem",backgroundColor:"#fff",boxShadow:"0 -1px 3px rgba(0, 0, 0, 0.1)",borderTop:"1px solid #E0E0E0"},children:e.jsx(L,{variant:"outlined",sx:{background:"white",flexGrow:1,borderRadius:"1rem"},InputProps:{style:{borderRadius:"1rem"},endAdornment:e.jsx(A,{type:"submit",children:e.jsx(c,{})})},type:"text",placeholder:"Type a message...",value:o,onChange:t=>s(t.target.value)})})]})})}function P(){const r=M({from:"/chats/$chatId/",select:o=>o.chatId});return r?e.jsx(N,{chatId:r}):e.jsx("div",{children:"Error: chatId is missing"})}const W=F(P),O=C("/chats/$chatId/")({component:W});export{O as Route};
